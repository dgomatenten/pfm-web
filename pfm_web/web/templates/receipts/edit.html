{% extends "base.html" %}
{% block title %}Edit Receipt #{{ receipt.id }} · PFM Web{% endblock %}

{% block content %}
<section class="section">
  <a class="back-link" href="{{ url_for('web.receipt_detail', receipt_id=receipt.id) }}">← Back to receipt</a>
  <h2>Edit Receipt</h2>
  
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST" class="receipt-form">
    <div class="form-group">
      <label for="vendor_name">Vendor Name</label>
      <input type="text" id="vendor_name" name="vendor_name" 
             value="{{ receipt.vendor_name or '' }}" class="form-control">
    </div>

    <div class="form-group">
      <label for="vendor_address">Vendor Address</label>
      <input type="text" id="vendor_address" name="vendor_address" 
             value="{{ receipt.vendor_address or '' }}" class="form-control">
    </div>

    <div class="form-group">
      <label for="issued_at">Date</label>
      <input type="datetime-local" id="issued_at" name="issued_at" 
             value="{{ receipt.issued_at.strftime('%Y-%m-%dT%H:%M') if receipt.issued_at else '' }}" 
             class="form-control">
    </div>

    <div class="form-group">
      <label for="total_amount">Total Amount</label>
      <input type="number" id="total_amount" name="total_amount" step="0.01"
             value="{{ receipt.total_amount }}" class="form-control" required>
    </div>

    <div class="form-group">
      <label for="payment_method">Payment Method</label>
      <input type="text" id="payment_method" name="payment_method" 
             value="{{ receipt.payment_method or '' }}" class="form-control">
    </div>

    <div class="form-group">
      <label for="receipt_number">Receipt Number</label>
      <input type="text" id="receipt_number" name="receipt_number" 
             value="{{ receipt.receipt_number or '' }}" class="form-control">
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Save Changes</button>
      <a href="{{ url_for('web.receipt_detail', receipt_id=receipt.id) }}" class="btn">Cancel</a>
    </div>
  </form>

  <h3>Line Items</h3>
  <p><em>Item editing coming soon...</em></p>
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      {% for item in receipt.items %}
      <tr>
        <td>{{ item.item_name }}</td>
        <td>{{ item.quantity|round(2) }}</td>
        <td>{{ item.unit_price|currency(receipt.currency) }}</td>
        <td>{{ item.total_price|currency(receipt.currency) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<style>
.receipt-form {
  max-width: 600px;
  margin: 2rem 0;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.form-control {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
}

.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.btn-primary {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
}

.btn-primary:hover {
  background-color: #0056b3;
}

.btn-danger {
  background-color: #dc3545;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
}

.btn-danger:hover {
  background-color: #c82333;
}

.alert {
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 4px;
}

.alert-success {
  background-color: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
}

.alert-error {
  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
  color: #721c24;
}
</style>
{% endblock %}
